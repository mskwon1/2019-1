# 데이터 전처리

## 데이터 구조 선택

- 분석을 위해 수집한 데이터를 실제 사용 가능한 데이터로 만들기 위해서는 많은 사전작업이 필요함

  - **데이터 전처리** : 데이터 분석에 사용할 수 있는 적합한 데이터를 만들기 위한 사전 작업

- R환경에서 어떠한 데이터 구조로 표현할 것인지 결정해야함(벡터, 행렬, 리스트, 데이터프레임 등)

  - 하나의 차원만 갖고 있다 : 벡터

  - 2개 이상의 차원으로 구성되어 있다 : 행렬/배열/리스트/데이터프레임

    - 행렬이나 배열은 데이터가 모두 동일한 데이터 유형으로 구성되어있는경우

  - 데이터가 서로 다른 유형으로 구성되어 있으면서 테이블 형태로 표현 가능하다면 데이터프레임

    - 어떤 유형의 객체든 수용할 수 있음
    - 가장 널리 사용됨

    - 데이터프레임으로 표현할 수 없으면 리스트가 적합

## 데이터 유형 및 구조 변환

### 데이터 유형 변환

- 모든 객체는 Mode를 가짐(메모리에 물리적으로 저장되는 형태)
  - 숫자, 문자, 논리, 리스트, 함수
  - 하나의 모드만을 가질 수 있음
  - mode() 함수 : 인수로 주어진 객체의 모드 반환
- 벡터는 모든 원소가 동일한 모드여야 함
  - 리스트의 원소는 서로 다른 모드를 가질 수 있음
- 모든 객체는 모드와 별도로 클래스라는 추상적 형태를 가짐
  - R은 클래스에 따라 객체를 처리하는 방법을 결정
    - print : 객체의 클래스를 확인한 후 그에 맞는 적당한 하위 print함수 호출
- 문자형/숫자형 -> 다른 데이터 유형
  - 데이터 유형별 변환 함수 이용
  - as.character(x), as.complex(x), as.numeric(x), as.integer(x), as.logical(x)
    - 변환 불가능시 NA 출력
    - 벡터가 인수로 주어지면 벡터 연산 수행
    - 논리값은 숫자로 변환할 수 있음(TRUE = 1, FALSE = 0)

### 데이터 구조 변환

- 데이터 전처리 작업 중 빈번히 발생
- as.data.frame(x), as.list(x), as.matrix(x), as.vector(x), as.factor(x)
  - 확인 : is.data.frame(x) 등

#### 벡터에서 변환

- as.list(벡터) : 벡터의 각 원소가 리스트의 원소로 변환
  - list(벡터) 함수 이용시 **벡터 전체를 하나의 원소**로 갖는 리스트가 생성
- 행렬
  - 하나의 열로 구성된 행렬로 변환 : cbind(벡터) / as.matrix(벡터)
  - 하나의 행으로 구성된 행렬로 변환 : rbind(벡터)
  - 행과 열의 개수를 지정하여 벡터로부터 행렬을 생성하려면 matrix()함수
- 데이터프레임
  - 하나의 열로 구성 : as.data.frame(벡터)
  - 하나의 행으로 구성 : rbind()함수로 행렬로 변환한 후 as.data.frame() 함수 이용

#### 행렬에서 변환

- 행렬에 as.vector(), as.list(), as.data.frame() 함수 적용

#### 리스트에서 변환

- 벡터로 변환 : unlist()
  - 리스트의 원소에 이름이 있을 때는 이름을 갖는 벡터로 변환
  - as.vector()는 아무런 변화가 없음
  - 리스트에 숫자와 문자가 섞여있으면 모두 문자로 변환됨
- 행렬로 변환 : unlist()로 벡터로 변환한 뒤, 벡터를 행렬로 변환
  - 리스트의 원소 이름을 행렬의 행 또는 열의 이름으로 사용하려면 dimnames인수 추가로 지정
  - matrix()나 as.matrix()함수를 적용하면 변환된 결과를 얻을 수 없음

- 데이터프레임으로 변환 : as.data.frame() 함수 이용
  - 숫자와 문자가 섞여있을 시 숫자는 숫자 벡터로, 문자는 팩터로 변환

#### 데이터프레임에서 변환

- 벡터를 생성 : 데이터프레임 인덱싱 이용

  - 하나의 행을 추출할 시 데이터프레임으로 반환, 열을 추출하면 벡터로 반환

- 전체를 벡터로 변환 : 데이터프레임이 하나의 행 또는 열로 구성되어있을때만 유효

  - as.matrix() 함수로 행렬로 변환한 후, as.vector()함수로 벡터로 변환
  - 데이터프레임의 원소가 모두 숫자이거나 모두 문자일때에만 의미가있음

  - 문자와 숫자가 섞여있으면 모두 문자로 변환

- 리스트로 변환 : as.list()

  - 숫자와 문자가 섞여있으면 숫자는 벡터, 문자는 팩터로 변환

- 행렬로 변환 : as.matrix()

  - 숫자로만 구성되어 있으면 숫자로 구성된 행렬을 얻음
  - 문자로만 구성되어 있으면 문자로 구성된 행렬을 얻음
  - 섞여있으면 모든 값들은 문자로 변환되어 **문자로 구성된 행렬**을 얻음

## 결합

- 다른 곳에 저장된 데이터를 서로 합쳐야 할 때
- 실습 부분 책 + 정오표 참조

### 열 결합

- 결합하고자 하는 데이터셋이 동일한 행으로 구성되어 있을 때, **수평으로 결합**
- data.frame(), cbind() 함수로 기준이 되는 데이터셋의 **오른쪽에 열을 추가**하는 형태로 데이터프레임/행렬을 결합

### 행 결합

- 결합하고자 하는 데이터셋이 동일한 열을 갖고 있을 때, **수직으로 결합**
- rbind()함수로 기준이 되는 데이터셋의 **아래에 행을 추가**하는 형태로 데이터프레임/행렬을 결합

### 공통 열에 의한 결합

- 결합하고자 하는 데이터셋이 **공통 열**을 기준으로 데이터를 결합
  - 데이터베이스의 JOIN 작업과 동일
  - merge()함수를 이용하여 두 데이터셋의 **교집합/합집합**을 만듬
  - match() 함수 / %in% 연산자도 유사한 작업 수행

## 서브셋

- 데이터셋으로부터 데이터 일부를 추출하여 서브셋을 만드는 작업
- 후속 분석 작업에 활용
- R의 다양한 인덱싱방법을 이용
- 실습부분 책 참조

### $

- 데이터셋으로부터 하나의 원소를 추출
- 데이터프레임에 적용시 벡터 반환
- 이름을 갖는 리스트에 적용시 해당 원소 추출

### [[]]

- 하나의 원소를 반환
- 이름 또는 위치로 원소 선택 가능
- 리스트와 데이터프레임에 사용가능

### []

- 데이터셋으로부터 여러개의 원소를 추출

### 소팅

- 데이터 분석이나 전처리 작업중 흔히 발생
- sort() 함수를 이용해 벡터를 소팅할 수 있음
  - 달리 지정하지 않으면 오름차순으로 소팅
  - 내림차순으로 소팅할려면 decreasing=TRUE 옵션 지정
  - 벡터에 NA가 포함되어 있을 경우 NA값을 맨앞/뒤로 위치시키기
    - na.last 지정안할 경우(기본값 NA) 
      - 결과에는 NA값이 출력되지 않음
    - na.last = TRUE 지정시 NA값이 결과의 맨 뒤에 위치
    - na.last = FALSE 지정시 NA값이 결과의 맨 앞에 위치

- order() 함수 : 벡터가 소팅되었을 때의 원소의 순서를 원소의 인덱스로 반환
  - 벡터 자체를 소팅하는게 아니라, 소팅되었을 경우의 순서를 나타냄
  - 데이터프레임을 소팅할 때 유용
  - 두 개 이상의 벡터를 인수로 제공하면 두 개 이상의 열을 이용한 소팅이 가능
    - 첫번째 벡터로 소팅 순서 결정, 동률 발생 시 나머지 벡터에 의해 소팅
    - 모든 열이 동일하게 오름차순 또는 내림차순의 쇵 순서를 가짐
- xtfrm() 함수 : 어떤 열은 오름차순, 어떤 열은 내림차순으로 정렬할 필요가 있을 경우
  - 주어진 벡터를 오름차순의 소팅 순서를 나타내는 숫자 벡터로 변환
  - 변환한 뒤 음수로 만들면 내림차순으로 소팅방법 변경 가능